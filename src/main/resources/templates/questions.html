<div class="container">
    <h1 class="text-center">Прашања</h1>

    <div id="content1">
        <div class="row justify-content-center mt-5 mb-2">
            <div class="col-6" id="question_text">
                Еден ден лисицата беше гладна и насекаде бараше храна. Таа дојде до едно лозје и здогледа грозје како виси од лозата.
                Се обиде да го достигне но не успеа бидејќи беше многу високо. Најпосле таа рече:
                „Грозјето е горчливо, не ми се допаѓа“, и си замина.
            </div>
        </div>
        <div class="row justify-content-end mt-5 mb-2">
            <div class="col-4">
                <img id="audioIcon" src="img/audio.png" class="d-block" width="50px" height="50px">
                <audio id="audio_text" src=""></audio>
            </div>
        </div>
    </div>

    <div id="content2" hidden>
        <div class="row justify-content-center mt-5 mb-2">
            <div class="col-4">
                <button type="button" class="btn btn-lg btn-warning w-100" id="questionTitle">Што бараше лисицата?</button>
            </div>
        </div>

        <div class="row justify-content-center mt-5 mb-2">
            <div class="col-2">
                <button type="button" class="btn btn-lg btn-info btn-default w-100 response" id="ans1">Храна</button>
            </div>
            <div class="col-1">
                <img src="img/audio.png" class="rounded mx-auto" width="35px" height="35px">
                <audio id="ans1_audio" src="audio/hint.m4a"></audio>
            </div>
        </div>
        <div class="row justify-content-center mt-5 mb-2">
            <div class="col-2">
                <button type="button" class="btn btn-lg btn-info btn-default w-100 response" id="ans2">Вода</button>
            </div>
            <div class="col-1">
                <img src="img/audio.png" class="rounded mx-auto" width="35px" height="35px">
                <audio id="ans2_audio" src="audio/hint.m4a"></audio>
            </div>
        </div>
        <div class="row justify-content-center mt-5 mb-2">
            <div class="col-2">
                <button type="button" class="btn btn-lg btn-info btn-default w-100 response" id="ans3">Засолниште</button>
            </div>
            <div class="col-1">
                <img src="img/audio.png" class="rounded mx-auto" width="35px" height="35px">
                <audio id="ans3_audio" src="audio/hint.m4a"></audio>
            </div>
        </div>
    </div>

    <div class="row justify-content-center mt-5 mb-2">
        <div class="col-3">
            <button type="button" class="btn btn-md btn-primary w-100" id="next">Следно</button>
        </div>
    </div>

</div>

<script>
    let apiURL = "http://localhost:8080/api/questions";
    let questions;
    let currentQuestion = 0;

    $.ajax({
        url: apiURL,
        contentType: "application/json",
        dataType: 'json',
        success: function(result){
            questions = result;
            setText();
        }
    });

    function checkAnswer(response) {
        if(questions[currentQuestion-1].correctAnswer.responseText.toLowerCase()===response.toLowerCase()) {
            alert("TOCEN ODGOVOR!");
            setText();
        } else {
            alert("POGRESEN ODGOVOR!");
        }
    }

    function setText() {
        if(currentQuestion>=questions.length) {
            currentQuestion = 0;
        }

        document.getElementById("question_text").innerText = questions[currentQuestion].textQuestion;
        document.getElementById('content1').hidden = false;
        document.getElementById('content2').hidden = true;
        document.getElementById('next').hidden = false;
    }

    function nextQuestion() {
        document.getElementById("questionTitle").innerHTML = questions[currentQuestion].questionTitle;
        document.getElementById("audio_text").src = questions[currentQuestion].audioPath;
        let arrResponses = document.getElementsByClassName("response");

        for(let i=0; i<arrResponses.length; i++) {
            let questionResponses = questions[currentQuestion].responses;

            arrResponses[i].replaceWith(arrResponses[i].cloneNode(true));

            arrResponses[i].addEventListener("click", function () {
                checkAnswer(questionResponses[i].responseText);
            });

            arrResponses[i].innerHTML = questionResponses[i].responseText;
            document.getElementById("ans"+(i+1)+"_audio").src= questionResponses[i].audioPath;
        }

        currentQuestion++;
    }

    document.getElementById("next").addEventListener("click", function(){
        nextQuestion();
        document.getElementById('content1').hidden = true;
        document.getElementById('content2').hidden = false;
        document.getElementById('next').hidden = true;
    });

    document.getElementById("audioIcon").addEventListener("click", function(){
        document.getElementById('audio_text').play();
    });
</script>